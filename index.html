<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilalAI: Haf覺zal覺 Sohbet & Kod Asistan覺</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #e9eef2; margin: 0; }
        .chat-container { width: 95%; max-width: 800px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 0; }
        
        /* 覺kt覺 Alan覺 Stili */
        #output { border: 1px solid #ddd; padding: 15px; min-height: 200px; margin-bottom: 20px; border-radius: 8px; background-color: #f7f9fb; overflow-y: auto; max-height: 60vh; }
        
        /* Kod Blou Stili - Belirginlik ve Kopyalanabilirlik */
        pre { 
            background-color: #272822; 
            color: #f8f8f2; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto; 
            font-family: 'Consolas', 'Courier New', monospace; 
            font-size: 0.9em; 
            position: relative; 
        }
        code { background-color: transparent; color: inherit; padding: 0; }

        /* Kullan覺c覺 Giri Alan覺 */
        .input-area { display: flex; gap: 10px; }
        #userInput { flex-grow: 1; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        #sendButton { padding: 12px 25px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; transition: background-color 0.3s; }
        #sendButton:hover { background-color: #0056b3; }
        #sendButton:disabled { background-color: #adb5bd; cursor: not-allowed; }

        /* Y羹kleme Simgesi */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="chat-container">
    <h2> BilalAI - Haf覺zal覺 Asistan</h2>
    <div id="output"><strong>Ho geldiniz!</strong> Ben BilalAI. nceki konumalar覺m覺z覺 hat覺rlayarak size yard覺mc覺 olabilirim.</div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="Bir ey sorun (rn: nceki kodda unu deitir)...">
        <button id="sendButton">G繹nder</button>
        <div id="loader" class="loader"></div>
    </div>
</div>

<script>
    // *******************************************************************
    // !!! API Anahtar覺n覺z buraya yerletirildi !!! 
    // *******************************************************************
    const API_KEY = "AIzaSyAtTbCNCtOQJDCnYUb9wKFaKfG6bU-69fk"; 
    
    // API endpoint ve model ad覺
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
    
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const outputDiv = document.getElementById('output');
    const loader = document.getElementById('loader');

    // KONUMA GEM襤襤 (HAFIZA) D襤Z襤S襤
    // Bu dizi, her baar覺l覺 kullan覺c覺-AI mesaj 癟iftini saklar.
    const conversationHistory = []; 

    // Konuma ge癟miini HTML olarak bi癟imlendirip ekrana yazan ilev.
    function formatHistory() {
        // Ekran覺 temizle
        outputDiv.innerHTML = ''; 
        
        // Sistem Talimat覺 (Sadece g繹r羹nt羹den 癟覺karmak i癟in gerekli)
        const systemContext = "Sen BilalAI adl覺, hem kodlama hem de genel sohbet konular覺nda uzman, yard覺msever bir yapay zekas覺n. Cevaplar覺n T羹rk癟e, bilgilendirici ve dost癟a olmal覺d覺r. Kullan覺c覺 kod istediinde cevab覺n覺 kod bloklar覺 (```) i癟inde vermeye 繹zen g繹ster.";

        // Ge癟miteki her bir konuma s覺ras覺n覺 (turn) d繹ng羹ye al
        conversationHistory.forEach(turn => {
            const isUser = turn.role === "user";
            let text = turn.parts[0].text;
            
            // Eer rol kullan覺c覺 ise, AI'a g繹nderilen balam覺 (systemContext) metinden temizle
            if (isUser) {
                // Kullan覺c覺n覺n ger癟ek sorusunu bul ve temizle
                const userQuestionMatch = text.match(/Kullan覺c覺 sorusu: ([\s\S]*)/);
                if (userQuestionMatch) {
                    text = userQuestionMatch[1].trim();
                } else {
                    // G羹venlik ama癟l覺, sadece balam覺 kald覺r
                    text = text.replace(systemContext, '').replace('Kullan覺c覺 sorusu:', '').trim();
                }
                outputDiv.innerHTML += `<p><strong>Siz:</strong> ${text}</p>`;
            } else {
                // AI yan覺t覺n覺 bi癟imlendir (Kod bloklar覺n覺 HTML'e 癟evir)
                const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
                let processedText = text.replace(codeBlockRegex, (match, language, code) => {
                    const safeCode = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    const langDisplay = language ? `\n\n// Dil: ${language.toUpperCase()}\n\n` : '';
                    return `<pre><code>${langDisplay}${safeCode.trim()}</code></pre>`;
                });
                
                // Normal metin paragraflar覺n覺 ay覺r ve bi癟imlendir
                processedText = processedText.split('\n\n').map(p => {
                    if (p.trim() && !p.startsWith('<pre>')) {
                        return `<p>${p.trim()}</p>`;
                    }
                    return p;
                }).join('');
                
                outputDiv.innerHTML += `<p><strong>BilalAI:</strong></p>${processedText}`;
            }
            outputDiv.innerHTML += '<hr>';
        });

        // Sayfay覺 her zaman en alta kayd覺r
        outputDiv.scrollTop = outputDiv.scrollHeight;
    }

    // G繹nderme 襤levi
    async function sendMessage() {
        const prompt = userInput.value.trim();
        if (!prompt) return;

        // Y羹kleme durumu ayarlar覺
        sendButton.disabled = true;
        loader.style.display = 'block';
        outputDiv.innerHTML += `<p><strong>Siz:</strong> ${prompt}</p><hr><p>AI: Cevap bekleniyor...</p>`;
        userInput.value = '';
        
        // BilalAI'n覺n talimat覺 (API'nin kabul ettii tek ge癟erli y繹ntem: Prompt'a ekleme)
        const systemContext = "Sen BilalAI adl覺, hem kodlama hem de genel sohbet konular覺nda uzman, yard覺msever bir yapay zekas覺n. Cevaplar覺n T羹rk癟e, bilgilendirici ve dost癟a olmal覺d覺r. Kullan覺c覺 kod istediinde cevab覺n覺 kod bloklar覺 (```) i癟inde vermeye 繹zen g繹ster.";
        
        // API'ye g繹nderilecek final prompt (Talimat + Kullan覺c覺n覺n sorusu)
        const finalPromptForRequest = `${systemContext}\n\nKullan覺c覺 sorusu: ${prompt}`;

        // 襤stee dahil edilecek ge癟erli kullan覺c覺 mesaj覺
        const currentUserMessage = { role: "user", parts: [{ text: finalPromptForRequest }] };
        
        // 襤stee g繹nderilecek i癟erik = T羹m ge癟mi + mevcut mesaj
        const contentsForRequest = [...conversationHistory, currentUserMessage]; 

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: contentsForRequest,
                    
                    generationConfig: {
                        temperature: 0.7 
                    }
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API 襤stek Hatas覺 (${response.status}): ${errorData.error.message}`);
            }

            const data = await response.json();
            
            const aiResponseText = data.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (aiResponseText) {
                // BAARILI: Mesajlar覺 GEM襤E EKLE
                conversationHistory.push(currentUserMessage);
                conversationHistory.push({ role: "model", parts: [{ text: aiResponseText }] });

                // TM GEM襤襤 yeniden 癟iz
                formatHistory();
            } else {
                outputDiv.innerHTML += `<p style="color: orange;"><strong>UYARI:</strong> BilalAI ge癟erli bir yan覺t 羹retemedi. (Bo yan覺t veya g羹venlik filtresi.)</p>`;
            }

        } catch (error) {
            console.error('襤stek Hatas覺:', error);
            // Sadece hata mesaj覺n覺 ekrana bas, ge癟mii g羹ncelleme
            outputDiv.innerHTML += `<p style="color: red;"><strong>KR襤T襤K HATA:</strong> Balant覺 veya API sorunu: ${error.message}</p>`;
        } finally {
            sendButton.disabled = false;
            loader.style.display = 'none';
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
    }

    // Olay Dinleyicileri
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

</script>

</body>
</html>
