<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilalAİ - Pro Asistan</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0f0f0f; --chat-bg: #1a1a1a; --user-msg: #005c4b; --ai-msg: #262626; --accent: #00a884; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #e9edef; height: 100vh; display: flex; flex-direction: column; }
        
        header { background: var(--chat-bg); padding: 15px; text-align: center; border-bottom: 1px solid #333; color: var(--accent); font-size: 1.4rem; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .msg-box { display: flex; flex-direction: column; max-width: 85%; }
        .user { align-self: flex-end; }
        .ai { align-self: flex-start; }

        .name-tag { font-size: 0.8rem; margin-bottom: 4px; font-weight: bold; }
        .user .name-tag { color: #8696a0; text-align: right; margin-right: 5px; }
        .ai .name-tag { color: var(--accent); margin-left: 5px; }

        .bubble { padding: 12px 16px; border-radius: 15px; font-size: 1rem; line-height: 1.6; position: relative; word-wrap: break-word; }
        .user .bubble { background: var(--user-msg); border-top-right-radius: 2px; }
        .ai .bubble { background: var(--ai-msg); border-top-left-radius: 2px; border: 1px solid #333; }

        /* Kod Bloğu Stili */
        pre { background: #000 !important; padding: 15px; border-radius: 8px; margin: 10px 0; overflow-x: auto; position: relative; border: 1px solid #444; }
        code { font-family: 'Consolas', 'Monaco', monospace; color: #dcdcaa; font-size: 0.9rem; }
        
        .copy-btn { position: absolute; right: 10px; top: 10px; background: #444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; }
        .copy-btn:hover { background: #666; }

        .ai-img { width: 100%; max-width: 450px; border-radius: 12px; margin-top: 10px; border: 2px solid #333; }

        .input-bar { background: var(--chat-bg); padding: 20px; display: flex; gap: 12px; border-top: 1px solid #333; }
        input { flex: 1; background: #2a2a2a; border: 1px solid #444; padding: 14px; border-radius: 25px; color: white; outline: none; font-size: 1rem; }
        input:focus { border-color: var(--accent); }
        
        button { background: var(--accent); border: none; width: 50px; height: 50px; border-radius: 50%; color: white; cursor: pointer; transition: 0.2s; font-size: 1.2rem; }
        button:hover { transform: scale(1.05); background: #008f6f; }

        .loader { display: none; padding: 0 20px 10px; font-size: 0.85rem; color: var(--accent); animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    </style>
</head>
<body>

<header>BilalAİ</header>

<div id="chat-area">
    <div class="msg-box ai">
        <div class="name-tag">BilalAİ</div>
        <div class="bubble">Selam! Ben BilalAİ. Bana gerçek kodlar yazdırabilir, sorular sorabilir veya resim çizdirebilirsin. Ne yapalım?</div>
    </div>
</div>

<div id="loader" class="loader">BilalAİ düşünüyor ve yazıyor...</div>

<div class="input-bar">
    <input type="text" id="input" placeholder="Kod yazdır, soru sor veya resim iste...">
    <button id="send"><i class="fas fa-paper-plane"></i></button>
</div>

<script>
    const chatArea = document.getElementById('chat-area');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const loader = document.getElementById('loader');

    function createMsg(text, type) {
        const box = document.createElement('div');
        box.className = `msg-box ${type}`;
        
        const tag = document.createElement('div');
        tag.className = 'name-tag';
        tag.innerText = type === 'user' ? 'Sen' : 'BilalAİ';

        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        
        if (type === 'ai') {
            bubble.innerHTML = marked.parse(text);
            bubble.querySelectorAll('pre').forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerText = 'Kopyala';
                btn.onclick = () => {
                    navigator.clipboard.writeText(pre.innerText.replace('Kopyala', ''));
                    btn.innerText = 'Kopyalandı!';
                    setTimeout(() => btn.innerText = 'Kopyala', 2000);
                };
                pre.appendChild(btn);
            });
        } else {
            bubble.innerText = text;
        }

        box.appendChild(tag);
        box.appendChild(bubble);
        chatArea.appendChild(box);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    async function chat(msg) {
        loader.style.display = 'block';
        const lowMsg = msg.toLowerCase();

        // 1. GÖRSEL OLUŞTURMA MANTIĞI
        if (lowMsg.includes("çiz") || lowMsg.includes("resim") || lowMsg.includes("fotoğraf") || lowMsg.includes("görsel")) {
            const prompt = msg.replace(/(çiz|yap|resmi|görseli|fotoğrafı|oluştur|bir|tane)/gi, "").trim();
            const finalPrompt = prompt || "cyberpunk city";
            const imgUrl = `https://pollinations.ai/p/${encodeURIComponent(finalPrompt)}?width=1024&height=1024&nologo=true`;
            
            setTimeout(() => {
                createMsg(`İstediğin görseli senin için tasarladım: \n\n <img src="${imgUrl}" class="ai-img">`, 'ai');
                loader.style.display = 'none';
            }, 1500);
            return;
        }

        // 2. GERÇEK AI CEVABI (Hugging Face - Anahtarsız)
        try {
            // Soruya göre mantıklı cevaplar için basit bir yönlendirme
            const response = await fetch("https://api-inference.huggingface.co/models/HuggingFaceH4/zephyr-7b-beta", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    inputs: `<|system|>\nSen BilalAİ isimli yardımsever bir asistansın. Kod yazabilir ve sohbet edebilirsin. Cevaplarını Türkçe ver.</s>\n<|user|>\n${msg}</s>\n<|assistant|>`,
                    parameters: { max_new_tokens: 500, temperature: 0.7 }
                })
            });

            const data = await response.json();
            let aiText = "";

            if (data && data[0] && data[0].generated_text) {
                aiText = data[0].generated_text.split("<|assistant|>")[1].trim();
            } else {
                // Yedek Yanıt Sistemi (API yoğunsa)
                if(lowMsg.includes("nasılsın")) aiText = "Harikayım dostum! Seninle sohbet etmek çok keyifli. Sen nasılsın?";
                else if(lowMsg.includes("kod")) aiText = "Hangi dilde kod yazmamı istersin? Örneğin: 'Python ile yılan oyunu yaz' diyebilirsin.";
                else aiText = "Şu an seni duyabiliyorum ama model çok yoğun. Bana tekrar yazar mısın?";
            }

            createMsg(aiText, 'ai');
        } catch (e) {
            createMsg("Bağlantı hatası oluştu ama ben buradayım! Ne sormuştun?", 'ai');
        } finally {
            loader.style.display = 'none';
        }
    }

    function process() {
        const val = input.value.trim();
        if (!val) return;
        createMsg(val, 'user');
        input.value = '';
        chat(val);
    }

    sendBtn.onclick = process;
    input.onkeypress = (e) => { if (e.key === 'Enter') process(); };
</script>

</body>
</html>
