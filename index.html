<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Zeka Nesne Tanıma (API Gerekmez)</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; }
        .container { position: relative; margin-top: 20px; border: 5px solid #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        video { display: block; background: #000; }
        canvas { position: absolute; top: 0; left: 0; }
        .status { margin-top: 10px; font-weight: bold; color: #555; }
        h1 { color: #333; }
    </style>
</head>
<body>

    <h1>Canlı Nesne Tanıma AI</h1>
    <div class="status" id="status">Model yükleniyor, lütfen bekleyin...</div>

    <div class="container">
        <video id="webcam" autoplay muted width="640" height="480"></video>
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('canvas');
        const status = document.getElementById('status');
        const ctx = canvas.getContext('2d');
        let model;

        // 1. Kamerayı Başlat
        async function setupWebcam() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            return new Promise((resolve) => {
                video.onloadedmetadata = () => resolve();
            });
        }

        // 2. Modeli Yükle ve Nesneleri Tahmin Et
        async function runAI() {
            model = await cocoSsd.load();
            status.innerText = "Yapay Zeka Hazır! Kameraya bir şeyler göster.";
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            detectFrame();
        }

        async function detectFrame() {
            const predictions = await model.detect(video);
            renderPredictions(predictions);
            requestAnimationFrame(detectFrame);
        }

        // 3. Sonuçları Ekrana Çiz
        function renderPredictions(predictions) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            predictions.forEach(prediction => {
                // Kutu Çizimi
                ctx.strokeStyle = "#00FF00";
                ctx.lineWidth = 4;
                ctx.strokeRect(...prediction.bbox);

                // Metin Çizimi
                ctx.fillStyle = "#00FF00";
                ctx.font = "18px Arial";
                ctx.fillText(
                    `${prediction.class} (%${Math.round(prediction.score * 100)})`,
                    prediction.bbox[0], 
                    prediction.bbox[1] > 10 ? prediction.bbox[1] - 5 : 10
                );
            });
        }

        setupWebcam().then(runAI);
    </script>
</body>
</html>
